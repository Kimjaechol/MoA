# MoA (Mixture of Agents) 특허출원 초안

**출원인:** (기재 필요)
**발명의 명칭:** 다중 AI 에이전트 통합 플랫폼 및 옴니채널 지능형 비서 시스템
**출원일:** 2026년 2월

---

## 발명의 명칭 (Title of Invention)

**한국어:** 복수의 대규모 언어 모델을 전략적으로 라우팅하는 옴니채널 AI 에이전트 통합 시스템 및 방법

**영어:** Omni-Channel AI Agent Integration System and Method with Strategic Routing of Multiple Large Language Models

---

## 기술 분야 (Technical Field)

본 발명은 인공지능 기반 대화형 비서 시스템에 관한 것으로, 보다 구체적으로는 복수의 대규모 언어 모델(LLM)을 비용 효율성과 성능을 동시에 고려하여 전략적으로 선택 및 라우팅하고, 15개 이상의 메시징 채널과 데스크톱/모바일 애플리케이션을 단일 인터페이스로 통합하여, 사용자에게 100가지 이상의 전문 기능(skill)을 제공하는 옴니채널 AI 에이전트 통합 플랫폼에 관한 것이다.

---

## 배경기술 (Background Art)

### 종래기술의 문제점

1. **단일 모델 의존성**: 기존 AI 비서(ChatGPT, Claude, Gemini 등)는 각각 하나의 LLM 제공자에 종속되어, 해당 모델의 장애나 성능 저하 시 서비스 전체가 중단되는 문제가 있다.

2. **채널 파편화**: 사용자가 카카오톡, 텔레그램, 디스코드, 슬랙 등 여러 메신저를 사용하지만, 각 채널에서 별도의 AI 봇을 설정해야 하고, 채널 간 대화 맥락이 공유되지 않는다.

3. **비용 비효율**: 모든 요청에 최고 성능 모델(예: GPT-4, Claude Opus)을 사용하면 비용이 과다하고, 반대로 저가 모델만 사용하면 복잡한 작업의 품질이 저하된다.

4. **웹-로컬 간극**: 웹 기반 AI 서비스는 사용자의 로컬 파일 시스템에 접근할 수 없어, 실질적인 기기 제어 및 파일 관리 기능을 제공하지 못한다.

5. **설치 복잡성**: 기존 오픈소스 AI 에이전트(예: OpenClaw/ClawdBot)는 개발자가 아닌 일반 사용자가 설치하기 매우 어렵다.

---

## 발명의 내용 (Description of the Invention)

### 해결하고자 하는 과제

본 발명은 상기 종래기술의 문제점을 해결하기 위해, (1) 복수의 LLM을 사용자의 비용 전략에 따라 자동으로 선택하는 3단계 폴백(fallback) 라우팅 시스템, (2) 15개 이상의 메시징 채널을 단일 에이전트로 통합하는 옴니채널 아키텍처, (3) 웹과 로컬을 브릿지하는 하이브리드 데스크톱 엔진, (4) 원클릭 설치 및 자동 업데이트 시스템을 제공하는 것을 목적으로 한다.

### 과제의 해결 수단

#### 청구항 1: 3단계 LLM 폴백 라우팅 시스템

사용자 요청에 대해 최적의 AI 모델을 자동으로 선택하는 3단계 폴백 라우팅 방법으로서:

**제1단계 (사용자 키 우선):**
- 사용자가 등록한 개인 API 키가 있는 경우 해당 키로 LLM을 호출한다.
- 모델 우선순위: Claude > OpenAI > Gemini > Mistral > xAI
- 사용자의 전략 설정(가성비/최고성능)에 따라 모델 등급을 조정한다.
- 크레딧 비용: 기본 1배(1x).

**제2단계 (서버 키 사용):**
- 사용자 키가 없거나 제1단계가 모두 실패한 경우, 플랫폼이 보유한 서버 API 키를 사용한다.
- 가성비 전략: Gemini Flash → GPT-4o-mini → Claude Haiku
- 최고성능 전략: Claude Opus → GPT-5 → Gemini Flash
- 크레딧 비용: 서버 키 사용 시 2배(2x) 가산.

**제3단계 (최후 수단):**
- 제1, 2단계가 모두 실패한 경우, CJK 언어 혼합 이슈가 있는 모델(Groq/Llama, DeepSeek)을 사용자 키로만 호출한다.
- 서버 키로는 절대 호출하지 않음(품질 보장).

**제4단계 (오프라인 스마트 응답):**
- 모든 API 호출이 실패한 경우에도 사용자에게 카테고리별 맥락 인식 응답을 생성하여 서비스 중단 없이 응답한다.

#### 청구항 2: 카테고리 인식 스킬 라우팅 시스템

사용자 메시지를 7개 카테고리(일상, 업무, 문서, 코딩, 이미지, 음악, 기타)로 분류하고, 각 카테고리에 최적화된 시스템 프롬프트와 스킬 세트를 자동 매칭하는 방법으로서:

- 각 카테고리별로 전문화된 시스템 프롬프트를 LLM에 주입한다.
- 카테고리별 가용 스킬 목록을 LLM 컨텍스트에 포함시켜, 모델이 적절한 도구를 선택하도록 유도한다.
- 언어 규칙(한국어/영어/기타)을 시스템 프롬프트에 강제 주입하여, CJK 언어 혼합을 방지한다.

#### 청구항 3: 옴니채널 통합 에이전트 아키텍처

단일 AI 에이전트가 15개 이상의 메시징 채널(카카오톡, 텔레그램, 디스코드, 슬랙, LINE, WhatsApp, iMessage, Signal, MS Teams, Google Chat, Matrix, Mattermost, Twitch, Nostr, 웹)을 통해 사용자와 상호작용하는 시스템으로서:

- 각 채널의 고유한 메시지 포맷과 프로토콜을 표준화된 내부 메시지 형식으로 변환하는 채널 어댑터 레이어를 포함한다.
- 사용자의 세션과 대화 맥락이 채널 간에 공유되어, 카카오톡에서 시작한 대화를 웹에서 이어갈 수 있다.
- 채널별 페어링(pairing) 정책을 통해, 동일 사용자가 여러 채널에서 접근해도 하나의 계정으로 통합 관리된다.

#### 청구항 4: 하이브리드 웹-로컬 브릿지 데스크톱 엔진

웹 기반 AI 서비스의 편의성과 로컬 애플리케이션의 시스템 제어 능력을 결합하는 데스크톱 엔진으로서:

- Electron 기반 네이티브 래퍼가 웹 애플리케이션(`https://mymoa.app`)을 로드하되, 프리로드(preload) 스크립트를 통해 `window.moaDesktop` 브릿지 API를 노출한다.
- 상기 브릿지 API를 통해 웹 애플리케이션이 다음의 로컬 기능에 접근한다:
  - 파일 시스템 읽기/쓰기 (최대 10MB, 보안 경로 차단)
  - 디렉토리 탐색 및 드라이브 목록 조회
  - 시스템 다이얼로그 (파일 열기/저장)
  - 셸 명령 실행 (위험 명령어 블랙리스트 + 사용자 확인 대화상자)
- 보안 계층: `contextIsolation: true`, `nodeIntegration: false`, 민감 경로(System32, .ssh, .aws 등) 접근 차단, 위험 명령(rm -rf, mkfs, dd 등) 패턴 감지 및 차단.

#### 청구항 5: 크레딧 기반 하이브리드 과금 시스템

사용자의 자체 API 키와 플랫폼 제공 키를 결합한 하이브리드 과금 방법으로서:

- 사용자 자체 키 사용 시: 모델별 기본 크레딧 차감 (예: Gemini Flash 2크레딧, Claude Opus 15크레딧)
- 플랫폼 키 사용 시: 기본 크레딧의 2배 차감 (서버 비용 보전)
- 무료 가입 시 100크레딧 제공, 월간 쿼타 리셋
- 크레딧 팩 구매 및 월간 구독(Basic/Pro) 병행 지원
- 크레딧 잔액이 부족해도 채팅을 차단하지 않음 (사용자 경험 우선)

#### 청구항 6: AES-256-GCM 기반 사용자 API 키 관리 시스템

사용자가 등록한 외부 AI 제공자의 API 키를 안전하게 보관하고 사용하는 방법으로서:

- 등록 시: 사용자의 API 키를 AES-256-GCM 알고리즘으로 암호화하여 저장한다. IV(초기화 벡터)와 인증 태그를 암호문과 함께 패킹하여 단일 base64 문자열로 보관한다.
- 조회 시: 키 힌트(앞 4자 + 뒤 4자)만 노출하고, 실제 키는 서버 사이드에서만 복호화하여 LLM API 호출에 사용한다.
- 삭제 시: 데이터베이스에서 완전 삭제(soft delete 아님).
- 마이그레이션: 레거시 평문 키는 자동으로 복호화를 시도하고, 실패 시 평문 그대로 반환하여 하위 호환성을 유지한다.

#### 청구항 7: 3중 보안 사용자 인증 시스템

일반 비밀번호 인증을 넘어 3중 보안 체계를 구현하는 인증 방법으로서:

- **제1층 (아이디/비밀번호):** scrypt 해싱(N=32768, r=8, p=1) + 32바이트 랜덤 솔트, 타이밍-세이프 비교
- **제2층 (구문번호):** 사용자가 설정한 보안 문구를 별도의 scrypt 해시로 저장하고, 로그인 시 비밀번호와 별개로 검증
- **제3층 (기기 인증):** 페어링 코드 기반 디바이스 등록으로, 등록되지 않은 기기에서의 접근을 차단
- 계정 잠금: 5회 로그인 실패 시 30분 자동 잠금
- 에러 메시지: "아이디 또는 비밀번호가 올바르지 않습니다"로 통합하여 사용자 열거 공격 방지

#### 청구항 8: 원클릭 설치 및 자동 업데이트 시스템

비개발자도 즉시 사용할 수 있는 배포 시스템으로서:

- 데스크톱: 플랫폼별 원클릭 설치파일(Windows NSIS, macOS DMG, Linux AppImage/deb) 제공
- 자동 업데이트: 앱 시작 시 Cloudflare R2에서 최신 버전을 확인하고, 백그라운드 다운로드 + 진행률 오버레이 표시 후 3초 카운트다운 재시작
- 모바일: 카카오톡 채널에서 디바이스 종류(데스크톱/모바일) 감지 후 적절한 설치 파일 링크 제공
- 웹: 별도 설치 없이 `https://mymoa.app`에서 즉시 사용 가능

#### 청구항 9: 옴니채널 다운로드 라우팅 시스템

카카오톡 등 메시징 채널에서 앱 다운로드를 안내할 때, 사용자의 디바이스 종류를 자동 감지하여 적절한 설치 파일을 제공하는 방법으로서:

- 데스크톱 카카오톡에서 접근 시: Windows/macOS/Linux 데스크톱 앱 다운로드 링크 제공
- 모바일 카카오톡에서 접근 시: Android(APK/Play Store) 또는 iOS(App Store) 링크 제공
- User-Agent 기반 플랫폼 감지 + 알림톡(AlimTalk) 기반 개인화 안내 메시지 발송

---

## 실시예 (Embodiments)

### 실시예 1: 3단계 LLM 라우팅의 실제 동작

사용자 A가 "이 보고서를 요약해줘"라고 요청한 경우:

1. 시스템이 메시지를 "문서" 카테고리로 분류
2. 문서 전문 시스템 프롬프트를 생성
3. **Phase 1**: 사용자 A가 등록한 Anthropic API 키로 Claude Sonnet 호출 시도
4. 만약 키가 만료된 경우 → 사용자의 OpenAI 키로 GPT-4o-mini 호출 시도
5. 만약 사용자 키가 모두 없는 경우 → **Phase 2**: 서버의 Gemini 키로 호출 (크레딧 2배)
6. 만약 Gemini API가 장애인 경우 → 서버의 GPT-4o-mini → Claude Haiku 순서로 시도
7. 만약 모든 API가 장애인 경우 → **Phase 4**: "문서 요약 기능을 준비 중입니다" + 카테고리별 가이드 제공

### 실시예 2: 옴니채널 대화 연속성

사용자 B가 카카오톡에서 "내일 회의 일정 잡아줘"라고 요청 후:

1. 카카오톡 채널 어댑터가 메시지를 표준 형식으로 변환
2. AI가 회의 일정 생성 응답을 카카오톡으로 전송
3. 사용자 B가 PC에서 웹(`mymoa.app/chat`)으로 접속
4. 동일한 세션 ID로 이전 카카오톡 대화가 로드됨
5. 웹에서 "방금 잡은 회의에 참석자 추가해줘"라고 이어서 대화
6. AI가 카카오톡에서의 맥락을 유지하면서 응답

### 실시예 3: 하이브리드 파일 관리

사용자 C가 데스크톱 앱에서 "E드라이브의 보고서.docx를 요약해줘"라고 요청:

1. 웹 UI가 `window.moaDesktop.readFile('E:\\보고서.docx')` 호출
2. Electron 프리로드 스크립트가 보안 검증 수행 (경로 블랙리스트 확인)
3. 파일 내용을 읽어 AI에게 전달
4. AI가 문서를 요약하여 응답

반면, 웹 브라우저에서 동일 요청 시:
1. `window.moaDesktop`이 존재하지 않음을 감지
2. "로컬 파일에 접근하려면 MoA 데스크톱 앱이 필요합니다" 안내 + 다운로드 링크 제공

---

## 발명의 효과 (Effects of the Invention)

1. **무중단 AI 서비스**: 3단계 폴백 + 오프라인 스마트 응답으로, 어떤 상황에서도 사용자에게 응답을 제공한다.
2. **비용 최적화**: 사용자 전략(가성비/최고성능) 설정에 따라 최적의 가격/성능 비율로 AI 모델을 자동 선택한다.
3. **채널 자유**: 사용자가 선호하는 어떤 메시징 채널에서든 동일한 AI 비서를 사용할 수 있다.
4. **접근성**: 원클릭 설치와 웹 접속으로, 비개발자도 즉시 100가지 이상의 AI 기능을 사용할 수 있다.
5. **보안**: 3중 인증, API 키 암호화, 로컬 파일 접근 보안 계층으로 사용자 데이터를 보호한다.
6. **확장성**: 채널 어댑터 아키텍처로 새로운 메시징 플랫폼을 플러그인 형태로 추가할 수 있다.

---

## 도면의 간단한 설명 (Brief Description of Drawings)

(별도 작성 필요)

- [도 1] MoA 시스템 전체 아키텍처 블록도
- [도 2] 3단계 LLM 폴백 라우팅 흐름도
- [도 3] 카테고리 인식 스킬 라우팅 흐름도
- [도 4] 옴니채널 메시지 처리 흐름도
- [도 5] 하이브리드 웹-로컬 브릿지 구조도
- [도 6] 크레딧 기반 과금 시스템 흐름도
- [도 7] 3중 보안 인증 시퀀스 다이어그램
- [도 8] 원클릭 설치 및 자동 업데이트 흐름도
- [도 9] AES-256-GCM 키 암호화 데이터 구조도

---

## 청구 범위 요약 (Claims Summary)

| 청구항 | 핵심 내용 | 신규성 근거 |
|--------|----------|------------|
| 1 | 3단계 LLM 폴백 라우팅 | 사용자키→서버키→최후수단 순서 + 전략별 모델 자동선택 |
| 2 | 카테고리 인식 스킬 라우팅 | 7개 카테고리별 전문화된 프롬프트 + 스킬 매칭 |
| 3 | 옴니채널 통합 에이전트 | 15개+ 채널 단일 통합 + 크로스채널 세션 공유 |
| 4 | 하이브리드 웹-로컬 브릿지 | 웹앱이 로컬 파일시스템 접근 + 보안 계층 |
| 5 | 크레딧 기반 하이브리드 과금 | 사용자키/서버키 구분 차등 과금 |
| 6 | API 키 암호화 관리 | AES-256-GCM + 힌트 노출 + 레거시 호환 |
| 7 | 3중 보안 인증 | 비밀번호 + 구문번호 + 기기인증 |
| 8 | 원클릭 설치/자동 업데이트 | 비개발자 접근성 + R2 기반 자동 업데이트 |
| 9 | 옴니채널 다운로드 라우팅 | 디바이스 감지 기반 적절한 앱 설치 안내 |

---

## 선행기술 대비 차별점 (Differentiation from Prior Art)

| 선행기술 | MoA의 차별점 |
|----------|-------------|
| ChatGPT (OpenAI) | 단일 모델만 사용 vs MoA는 7개+ 모델 자동 라우팅 |
| Claude (Anthropic) | 웹/앱 전용 vs MoA는 15개 메시징 채널 통합 |
| Poe (Quora) | 모델 선택을 사용자가 수동으로 vs MoA는 전략 기반 자동 선택 |
| OpenClaw/ClawdBot | 개발자 전용 CLI vs MoA는 원클릭 설치 + 웹 UI |
| Dify/LangChain | 개발자 프레임워크 vs MoA는 최종 사용자 제품 |
| Zapier AI | 워크플로우 자동화 vs MoA는 실시간 대화형 + 로컬 제어 |

---

## 부록: 기술 스택 요약

- **프론트엔드**: Next.js 15 + React 19 (웹), Electron 33 (데스크톱), Kotlin/Jetpack Compose (Android), SwiftUI 6.0 (iOS)
- **백엔드**: Vercel Serverless Functions, Supabase (PostgreSQL + RLS)
- **AI**: Anthropic Claude, OpenAI GPT, Google Gemini, Groq, DeepSeek, Mistral, xAI
- **보안**: AES-256-GCM, scrypt, timingSafeEqual
- **결제**: PortOne (한국), Stripe (해외)
- **채널**: Kakao, Telegram, Discord, Slack, LINE, WhatsApp, iMessage, Signal, MS Teams, Google Chat, Matrix, Mattermost, Twitch, Nostr, Web

---

*본 문서는 특허출원 초안이며, 특허 변리사의 검토 및 보완이 필요합니다.*
*청구항의 문구와 범위는 변리사와 협의하여 최종 결정해야 합니다.*
